<!doctype html>
<html class="no-js" lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />    
    <meta name="author" content="Vu Minh Khue"/>
    
    <title>Water Spinach</title>

    <link rel="stylesheet" href="/theme/css/foundation.min.css" />
    <link rel="stylesheet" href="/theme/css/main.css" type="text/css"/>
    <link rel="stylesheet" href="/theme/css/foundation-icons.css"/>
    
    <!-- Feeds -->

    <script src="/theme/js/vendor/modernizr.js"></script>

    <!-- Font Google Droid -->
    <link href='http://fonts.googleapis.com/css?family=Droid+Sans:400,700|Droid+Sans+Mono|Droid+Serif:400,700,400italic,700italic' rel='stylesheet' type='text/css'>

    <!-- Google Analytics -->
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-34233563-1']);
  _gaq.push(['_trackPageview']);
  _gaq.push(['_gat._anonymizeIp']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>

  </head>
  <body>
    
     
  <div class="off-canvas-wrap">
    <div class="inner-wrap">
      <!-- Mobile Navigation -->
      <nav class="tab-bar show-for-small-only">
        <section class="left-small show-for-small-only">
          <a class="left-off-canvas-toggle menu-icon"><span></span></a>
        </section>

        <section class="middle tab-bar-section">
          <h1 class="title">Water Spinach</h1>
        </section>

        <section class="right-small">
          <a class="right-off-canvas-toggle menu-icon"><span></span></a>
        </section>
      </nav>

      <aside class="left-off-canvas-menu">
        <ul class="off-canvas-list">
          <li  class="active" ><a href="../../../category/Programming.html">Programming</a></li>
          <li ><a href="../../../category/Random.html">Random</a></li>
          <li><a href="../../../archive.html">Archive</a>  </li>
          <li><a href="#">About Me</a></li>
        </ul>

      </aside>

      <aside class="right-off-canvas-menu">
        <ul class="off-canvas-list">
          <li><label>Tags</label></li>
          <li><a href="../../../tag/tunnel.html">tunnel</a></li>
          <li><a href="../../../tag/spring.html">spring</a></li>
          <li><a href="../../../tag/tutorial.html">tutorial</a></li>
          <li><a href="../../../tag/firewall.html">firewall</a></li>
          <li><a href="../../../tag/mysql.html">mysql</a></li>
          <li><a href="../../../tag/hibernate.html">hibernate</a></li>
          <li><a href="../../../tag/tcp.html">tcp</a></li>
          <li><a href="../../../tag/http.html">http</a></li>
          <li><a href="../../../tag/tunneling.html">tunneling</a></li>
          <li><a href="../../../tag/javascript.html">javascript</a></li>
          <li><a href="../../../tag/firefox.html">firefox</a></li>
          <li><a href="../../../tag/python.html">python</a></li>
          <li><a href="../../../tag/scalability.html">scalability</a></li>
          <li><a href="../../../tag/encoding.html">encoding</a></li>
          <li><a href="../../../tag/pygame.html">pygame</a></li>
          <li><a href="../../../tag/java.html">java</a></li>
          <li><a href="../../../tag/replication.html">replication</a></li>
          <li><a href="../../../tag/optimization.html">optimization</a></li>
          <li><a href="../../../tag/nexus.html">nexus</a></li>
          <li><a href="../../../tag/facebook graph.html">facebook graph</a></li>
          <li><a href="../../../tag/android.html">android</a></li>
        </ul>
      </aside>

      <!-- Medium or Wide Screen Navigation -->
      <nav class="top-bar hide-for-small-only" data-topbar>
        <ul class="title-area">
          <li class="name">
            <h1><a href="../../..">Water Spinach</a></h1>
          </li>
        </ul>

        <section class="top-bar-section">
          <ul class="left">
            <li  class="active" ><a href="../../../category/Programming.html">Programming</a></li>
            <li ><a href="../../../category/Random.html">Random</a></li>
            <li><a href="../../../archive.html">Archive</a>  </li>
            <li><a href="#">About Me</a></li>
          </ul>
        </section>
      </nav>

      <section class="main-section">
        <div class="row">
          <!-- Main Content -->
          <div class="small-12 medium-9 columns" role="content">
<article>
  <h2>Tunnel <span class="caps">TCP</span> through <span class="caps">HTTP</span> - A Python&nbsp;Implementation</h2>
  <p>Sometimes you find yourself behind a restrictive firewall. It blocks any request with destination port other than 80. You can do little thing like browsing&nbsp;websites. </p>
<p>The solution, if you want to access an application at other ports, is to direct your traffic to a server outside the firewall listening at port 80. The server then forwards the data to your desired destination. It also returns any response from that destination, i.e, <code>tunneling</code>. </p>
<p>The tunneling can leverage on existing protocol, like <span class="caps">HTTP</span>. I have written a simple tunnel program in Python. It contains two components, tunnel client and tunnel&nbsp;server. </p>
<h3>Tunnel&nbsp;Server</h3>
<p>It is basically a <span class="caps">HTTP</span> server which should resides on the host machine outside the firewall. When the server received a request from client, it relies on the request&#8217;s <span class="caps">HTTP</span> method to start the respective action&nbsp;sequence: </p>
<ul>
<li><span class="caps">POST</span> method: Signal a new connection. Send server the host and port of the target address. Server will establish a <span class="caps">TCP</span> connection with the target&nbsp;address.</li>
<li><span class="caps">PUT</span> method: Signal write request. Server gets data from request&#8217;s payload and send to target through the established <span class="caps">TCP</span>&nbsp;connection. </li>
<li><span class="caps">GET</span> method: Signal read request. Server get data from target and send back to client as <span class="caps">HTTP</span>&nbsp;Response. </li>
<li><span class="caps">DELETE</span> method: Signal end of connection. Server closes the <span class="caps">TCP</span> Connection with&nbsp;target.  </li>
</ul>
<p>You can start the server with&nbsp;command: </p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span class="go">python tunneld.py -p 80</span>
</pre></div>
</td></tr></table>

<p>The default port server listens to is 9999. Type <code>python tunneld.py -h</code> for help&nbsp;messages. </p>
<h3>Tunnel&nbsp;Client</h3>
<p>Tunnel Client resides on your local machine or any machine within the firewall. It follows the above mentioned protocol to talk to the Tunnel Server. It spawns separate threads to send and receive data from server (through <span class="caps">HTTP</span> <span class="caps">PUT</span> and <span class="caps">GET</span> respectively) and forward back to the local machine through&nbsp;socket.  </p>
<p>To start the&nbsp;client: </p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span class="go">python tunnel.py [target_host]:[target_port]</span>
</pre></div>
</td></tr></table>

<h3>Testing</h3>
<p>To test the Tunnel, for example, tunneling <span class="caps">IRC</span> connection, we use linux <code>nc</code> command: </p>
<p>First, start the tunnel&nbsp;service:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span class="go">python tunneld.py -p 80</span>
<span class="go">python tunnel.py -p 8889 -h localhost:80 irc.freenode.net:6667</span>
</pre></div>
</td></tr></table>

<p>Connect to the client using <code>nc</code> and send <span class="caps">IRC</span>&nbsp;messages: </p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span class="go">nc localhost 8889 </span>
<span class="go">NICK abcxyz</span>
<span class="go">USER abcxyz abcxyz irc.freenode.net :abcxyz</span>
</pre></div>
</td></tr></table>

<p>Result: </p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22</pre></div></td><td class="code"><div class="highlight"><pre><span class="go">:calvino.freenode.net NOTICE * :*** Looking up your hostname...</span>
<span class="go">:calvino.freenode.net NOTICE * :*** Checking Ident</span>
<span class="go">:calvino.freenode.net NOTICE * :*** Found your hostname</span>
<span class="go">:calvino.freenode.net NOTICE * :*** No Ident response</span>
<span class="go">NICK abcxyz</span>
<span class="go">USER abcxyz abcxyz irc.freenode.net :abcxyz</span>
<span class="go">:calvino.freenode.net 001 abcxyz :Welcome to the freenode Internet Relay Chat Network abcxyz</span>
<span class="go">:calvino.freenode.net 002 abcxyz :Your host is calvino.freenode.net[213.92.8.4/6667], running version ircd-seven-1.1.3</span>
<span class="go">:calvino.freenode.net 003 abcxyz :This server was created Sun Dec 4 2011 at 14:42:47 CET</span>
<span class="go">:calvino.freenode.net 004 abcxyz calvino.freenode.net ircd-seven-1.1.3 DOQRSZaghilopswz CFILMPQbcefgijklmnopqrstvz bkloveqjfI</span>
<span class="go">:calvino.freenode.net 005 abcxyz CHANTYPES=# EXCEPTS INVEX CHANMODES=eIbq,k,flj,CFLMPQcgimnprstz CHANLIMIT=#:120 PREFIX=(ov)@+ MAXLIST=bqeI:100 MODES=4 NETWORK=freenode KNOCK STATUSMSG=@+ CALLERID=g :are supported by this server</span>
<span class="go">:calvino.freenode.net 005 abcxyz CASEMAPPING=rfc1459 CHARSET=ascii NICKLEN=16 CHANNELLEN=50 TOPICLEN=390 ETRACE CPRIVMSG CNOTICE DEAF=D MONITOR=100 FNC TARGMAX=NAMES:1,LIST:1,KICK:1,WHOIS:1,PRIVMSG:4,NOTICE:4,ACCEPT:,MONITOR: :are supported by this server</span>
<span class="go">:calvino.freenode.net 005 abcxyz EXTBAN=$,arx WHOX CLIENTVER=3.0 SAFELIST ELIST=CTU :are supported by this server</span>
<span class="go">:calvino.freenode.net 251 abcxyz :There are 232 users and 70582 invisible on 31 servers</span>
<span class="go">:calvino.freenode.net 252 abcxyz 45 :IRC Operators online</span>
<span class="go">:calvino.freenode.net 253 abcxyz 10 :unknown connection(s)</span>
<span class="go">:calvino.freenode.net 254 abcxyz 34513 :channels formed</span>
<span class="go">:calvino.freenode.net 255 abcxyz :I have 6757 clients and 1 servers</span>
<span class="go">:calvino.freenode.net 265 abcxyz 6757 10768 :Current local users 6757, max 10768</span>
<span class="go">:calvino.freenode.net 266 abcxyz 70814 83501 :Current global users 70814, max 83501</span>
<span class="go">:calvino.freenode.net 250 abcxyz :Highest connection count: 10769 (10768 clients) (2194912 connections received)</span>
<span class="go">    ...</span>
</pre></div>
</td></tr></table>

<h3>It needs not be <span class="caps">HTTP</span></h3>
<p>Here I use tunneling tcp packages through <span class="caps">HTTP</span> protocol. It is an existing protocol, which gives the reusability to the program. But you can implement your own program on top of the tunneling <span class="caps">TCP</span> Connection. You just need to define your own application layer protocol on how the two end of the tunnel communicate, i.e, when to start sending data, when the data&nbsp;ends&#8230;</p>
<p>You can access the source code of the program <a href="https://github.com/khuevu/http-tunnel">here</a></p>
  <hr/>
  <h6>Written by <a href="../../../author/vu-minh-khue.html">Vu Minh Khue</a> in <a href="../../../category/Programming.html">Programming</a> on Mon 10 September 2012. Tags: <a href="../../../tag/http.html">http</a>, <a href="../../../tag/tcp.html">tcp</a>, <a href="../../../tag/tunneling.html">tunneling</a>, <a href="../../../tag/python.html">python</a>, </h6>
</article>

<hr/>
<div class="row">
  <div class="small-12 columns">
    <h3>Comments</h3>
    <div id="disqus_thread"></div>
    <script type="text/javascript">
      var disqus_shortname = 'waterspinach';
      (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
      })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
  </div>
</div>
          </div>

          <!-- Side Panels for Medium or Wide Screen -->
          <aside class="hide-for-small-only medium-3 columns">
            <div class="panel">
            <div>
              <!-- Pelican's tag cloud -->
              <label>Tags</label>
              <ul class="tagcloud">
                <li class="tag-4"><a href="../../../tag/tunnel.html">tunnel</a></li>
                <li class="tag-4"><a href="../../../tag/spring.html">spring</a></li>
                <li class="tag-4"><a href="../../../tag/tutorial.html">tutorial</a></li>
                <li class="tag-4"><a href="../../../tag/firewall.html">firewall</a></li>
                <li class="tag-1"><a href="../../../tag/mysql.html">mysql</a></li>
                <li class="tag-2"><a href="../../../tag/hibernate.html">hibernate</a></li>
                <li class="tag-4"><a href="../../../tag/tcp.html">tcp</a></li>
                <li class="tag-4"><a href="../../../tag/http.html">http</a></li>
                <li class="tag-4"><a href="../../../tag/tunneling.html">tunneling</a></li>
                <li class="tag-4"><a href="../../../tag/javascript.html">javascript</a></li>
                <li class="tag-4"><a href="../../../tag/firefox.html">firefox</a></li>
                <li class="tag-1"><a href="../../../tag/python.html">python</a></li>
                <li class="tag-2"><a href="../../../tag/scalability.html">scalability</a></li>
                <li class="tag-4"><a href="../../../tag/encoding.html">encoding</a></li>
                <li class="tag-4"><a href="../../../tag/pygame.html">pygame</a></li>
                <li class="tag-2"><a href="../../../tag/java.html">java</a></li>
                <li class="tag-4"><a href="../../../tag/replication.html">replication</a></li>
                <li class="tag-4"><a href="../../../tag/optimization.html">optimization</a></li>
                <li class="tag-4"><a href="../../../tag/nexus.html">nexus</a></li>
                <li class="tag-4"><a href="../../../tag/facebook graph.html">facebook graph</a></li>
                <li class="tag-2"><a href="../../../tag/android.html">android</a></li>
              </ul>
            </div>

            <div>
              <!-- Pelican's tag cloud -->
              <label>Archives</label>
              <ul class="side-nav">
                  <li>
                    <a href="/posts/2012">2012 (7)</a>
                  </li>
                  <li>
                    <a href="/posts/2013">2013 (5)</a>
                  </li>
              </ul>
            </div>

            <div>
              <label>Links</label>              
              <ul class="side-nav">

              </ul>
            </div>
          </div>
          </aside>
        </div>
        

      </section>

      <footer class="row">
        <div class="small-12 medium-9 columns">
          <hr/>
          <p class="text-center">
            Powered by <a href="http://getpelican.com">Pelican</a> and
            <a href="http://foundation.zurb.com/">Zurb Foundation</a>.
          </p>
        </div>
      </footer>

      <a class="exit-off-canvas"></a>
    </div>
  </div>
 
 
  <!-- Main Page Content and Sidebar -->
 
 

  <!-- Just before closing body tag -->
  <script src="/theme/js/vendor/jquery.js"></script> 
  <script src="/theme/js/vendor/fastclick.js"></script>
  <script src="/theme/js/foundation/foundation.min.js"></script>
  <script> $(document).foundation(); </script>  
  </body>
</html>